---
import Layout from "../layouts/Layout.astro";
import Header from '../components/HeaderIndex.astro';
import './../css/output.css'
import { ViewTransitions } from 'astro:transitions';
import { getUserActivo } from "../components/Cookies/Cookies.astro";
import { db, Usuario, eq } from "astro:db";

const cookies = Astro.request.headers.get('cookie')
const userActivo = await getUserActivo(cookies)
const infoUser = (await db.select().from(Usuario).where(eq(Usuario.id, userActivo)))[0]
console.log(infoUser);

---

<Layout>
    <Header/>
    <ViewTransitions/>
    <div class="md:flex h-96 max-w-7xl mx-auto">
        <div class="h-20 md:h-96 w-full md:w-1/3 p-2 md:p-8 md:max-w-80 md:min-w-56">
            <div class="w-full h-full bg-[#ffeed3] rounded shadow-[#DBAC63] shadow-lg p-4">
                <h3 class="font-bold text-xl">Menú</h3>
                <ul id="menu">
                    <li class="mt-2"><a class="hover:bg-[#DBAC63] hover:text-white p-1 rounded" id="datos" href="#">Tus datos</a></li>
                    <li class="mt-2"><a class="hover:bg-[#DBAC63] hover:text-white p-1 rounded" id="musica" href="#">Tu música</a></li>
                    <li class="mt-2"><a class="hover:bg-[#DBAC63] hover:text-white p-1 rounded" id="autenticacion" href="#">Autenticación</a></li>
                    <li class="mt-2"><a class="hover:bg-[#DBAC63] hover:text-white p-1 rounded" id="cerrarSesion" href="#">Cerrar sesión</a></li>
                </ul>
            </div>
        </div>
        <div class="h-96 w-full p-2 md:p-8">
            <div id="contenido" class="w-full h-full bg-[#ffeed3] rounded shadow-[#DBAC63] shadow-lg p-4">
                <form action="">
                    <h3 class="font-bold text-xl mb-2">Datos perfil</h3>
                    <img src={infoUser["imagenPerfil"] ? infoUser["imagenPerfil"] : "/src/logos/usuarioSinLogo.png"} class={infoUser["imagenPerfil"] ? "w-20" : "bg-white w-20"}>
                    <p>Nombre de usuario</p>

                    <h3 class="font-bold text-xl mt-4">Datos personales</h3>
                    <p>Nombre</p>
                    <p>Apellidos</p>
                    <p>Email</p>
                </form>
            </div>
        </div>
    </div>
</Layout>

<script>
document.getElementById("menu").addEventListener("click", (e) => {
    e.preventDefault()

    switch(e.target.id) {
        case "datos": 
            document.getElementById("contenido").innerHTML = `
                <h3 class="font-bold text-xl">Datos perfil</h3>
                <img src="" alt="Foto de perfil del usuario">
                <p>Nombre de usuario</p>

                <h3 class="font-bold text-xl">Datos personales</h3>
                <p>Nombre</p>
                <p>Apellidos</p>
                <p>Email</p>
            `; break;
        case "musica": 
            document.getElementById("contenido").innerHTML = `
                <h3 class="font-bold text-xl">Música del usuario (si es artista)...</h3>
            `; break;
        case "autenticacion": 
            document.getElementById("contenido").innerHTML = `
                <h3 class="font-bold text-xl">Autenticacion...</h3>
                <p>Cambiar contraseña</p>
                <p>Doble autenticación</p>
                <p>Borrar cuenta</p>
            `; break;
        case "cerrarSesion": 
            document.getElementById("contenido").innerHTML = `
                <h3>Cerrando la sesión...</h3>
            `; break;
    }
})

</script>
