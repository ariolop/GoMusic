---
import './../css/output.css'
import { Audios, Artista, Album, Usuario, Album_Audio } from 'astro:db';
import { db, eq } from 'astro:db';

const audios = (
    await db.select().from(
        Audios
    ).leftJoin(
        Album_Audio, eq(Album_Audio.idAudio, Audios.idAudio)
    ).innerJoin(
        Album, eq(Album_Audio.idAlbum, Album.idAlbum)
    ).innerJoin(
        Artista, eq(Album.idArtista, Artista.idArtista)
    ).innerJoin(
        Usuario, eq(Artista.idUsuario, Usuario.id)
    )
);

const randomPositions = []

const cantidadAudios = audios.length

while(randomPositions.length != 6)
{
    const numAlea = Math.floor(Math.random() * cantidadAudios)
    if (!randomPositions.includes(numAlea))
        randomPositions.push(numAlea) 
}

---

<div transition:persist class="flex h-full w-full sm:w-3/4 order-1 flex-wrap flex-col items-center p-4 px-4 md:px-12">
    <!-- 3 Botones para filtrar por Canciones, Podcast o Todo -->
    <div class="flex justify-evenly w-full lg:w-3/4 items-center h-10">
        <button class="bg-gray-200 hover:bg-gray-400 hover:text-white hover:font-bold w-1/3 sm:w-1/4 sm:max-w-28 mx-1 rounded-full h-fit py-2 px-3">Todos</button>
        <button class="bg-gray-200 hover:bg-gray-400 hover:text-white hover:font-bold w-1/3 sm:w-1/4 sm:max-w-28 mx-1 rounded-full h-fit py-2 px-3">Canciones</button>
        <button class="bg-gray-200 hover:bg-gray-400 hover:text-white hover:font-bold w-1/3 sm:w-1/4 sm:max-w-28 mx-1 rounded-full h-fit py-2 px-3">Podcasts</button>
    </div>
    
    <!-- Últimas canciones escuchadas, si no tiene, poder canciones o álbumes randoms -->
    <div id="cartas" class="grid grid-rows-3 grid-cols-2 lg:grid-rows-2 lg:grid-cols-3 w-full gap-4 mt-4 ">
        <a class="flex bg-gray-200 items-center justify-between rounded" href={"audio?id=" + audios[randomPositions[0]].Audios.idAudio}>
            <div class="w-3/4 flex items-center">
                <img class="rounded-tl rounded-bl w-8 h-8 sm:w-12 sm:h-12 lg:w-14 lg:h-14" src={audios[randomPositions[0]].Audios.rutaImagen} alt="">
                <p class="ml-3 text-xs sm:text-sm lg:text-base font-bold mr-1 text-balance" data-original={audios[randomPositions[0]].Audios.nombreAudio}>{audios[randomPositions[0]].Audios.nombreAudio}</p>
            </div>
            <button class="mr-2 text-[#cc9338]">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 sm:size-9">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z" />
                </svg>                  
            </button>
        </a>
        <a class="flex bg-gray-200 items-center justify-between rounded" href={"audio?id=" + audios[randomPositions[1]].Audios.idAudio}>
            <div class="w-3/4 flex items-center">
                <img class="rounded-tl rounded-bl w-8 h-8 sm:w-12 sm:h-12 lg:w-14 lg:h-14" src={audios[randomPositions[1]].Audios.rutaImagen} alt="">
                <p class="ml-3 text-xs sm:text-sm lg:text-base font-bold mr-1" data-original={audios[randomPositions[1]].Audios.nombreAudio}>{audios[randomPositions[1]].Audios.nombreAudio}</p>
            </div>
            <button class="mr-2 text-[#cc9338]">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 sm:size-9">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z" />
                </svg>                  
            </button>
        </a>
        <a class="flex bg-gray-200 items-center justify-between rounded" href={"audio?id=" + audios[randomPositions[2]].Audios.idAudio}>
            <div class="w-3/4 flex items-center">
                <img class="rounded-tl rounded-bl w-8 h-8 sm:w-12 sm:h-12 lg:w-14 lg:h-14" src={audios[randomPositions[2]].Audios.rutaImagen} alt="">
                <p class="ml-3 text-xs sm:text-sm lg:text-base font-bold mr-1" data-original={audios[randomPositions[2]].Audios.nombreAudio}>{audios[randomPositions[2]].Audios.nombreAudio}</p>
            </div>
            <button class="mr-2 text-[#cc9338]">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 sm:size-9">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z" />
                </svg>                  
            </button>
        </a>
        <a class="flex bg-gray-200 items-center justify-between rounded" href={"audio?id=" + audios[randomPositions[3]].Audios.idAudio}>
            <div class="w-3/4 flex items-center">
                <img class="rounded-tl rounded-bl w-8 h-8 sm:w-12 sm:h-12 lg:w-14 lg:h-14" src={audios[randomPositions[3]].Audios.rutaImagen} alt="">
                <p class="ml-3 text-xs sm:text-sm lg:text-base font-bold mr-1" data-original={audios[randomPositions[3]].Audios.nombreAudio}>{audios[randomPositions[3]].Audios.nombreAudio}</p>
            </div>
            <button class="mr-2 text-[#cc9338]">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 sm:size-9">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z" />
                </svg>                  
            </button>
        </a>
        <a class="flex bg-gray-200 items-center justify-between rounded" href={"audio?id=" + audios[randomPositions[4]].Audios.idAudio}>
            <div class="w-3/4 flex items-center">
                <img class="rounded-tl rounded-bl w-8 h-8 sm:w-12 sm:h-12 lg:w-14 lg:h-14" src={audios[randomPositions[4]].Audios.rutaImagen} alt="">
                <p class="ml-3 text-xs sm:text-sm lg:text-base font-bold mr-1" data-original={audios[randomPositions[4]].Audios.nombreAudio}>{audios[randomPositions[4]].Audios.nombreAudio}</p>
            </div>
            <button class="mr-2 text-[#cc9338]">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 sm:size-9">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z" />
                </svg>                  
            </button>
        </a>
        <a class="flex bg-gray-200 items-center justify-between rounded" href={"audio?id=" + audios[randomPositions[5]].Audios.idAudio}>
            <div class="w-3/4 flex items-center">
                <img class="rounded-tl rounded-bl w-8 h-8 sm:w-12 sm:h-12 lg:w-14 lg:h-14" src={audios[randomPositions[5]].Audios.rutaImagen} alt="">
                <p class="ml-3 text-xs sm:text-sm lg:text-base font-bold mr-1" data-original={audios[randomPositions[5]].Audios.nombreAudio}>{audios[randomPositions[5]].Audios.nombreAudio}</p>
            </div>
            <button class="mr-2 text-[#cc9338]">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 sm:size-9">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z" />
                </svg>                  
            </button>
        </a>
    </div>


    <!-- Lo mismo que antes, pero en forma de cuadrado -->
    <div class="flex justify-between w-full mt-4 flex-wrap">
        <h3 class="w-full text-xl md:text-2xl mb-2 font-bold">Recomendaciones para ti</h3>
        <div class="w-full grid grid-cols-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 lg:grid-rows-1">
            <div class="w-full text-center flex justify-center flex-wrap">
                <img class="w-full max-w-28" src="https://hdnqb6gk9llq7dvl.public.blob.vercel-storage.com/portadas/happy_day-5fTsYgd3tQ1fi4U5mNkoBFr0DVVRYl.webp" alt="">
                <p class="w-full">Nombre del album</p>
            </div>
            <div class="w-full text-center flex justify-center flex-wrap">
                <img class="w-full max-w-28" src="https://hdnqb6gk9llq7dvl.public.blob.vercel-storage.com/portadas/happy_day-5fTsYgd3tQ1fi4U5mNkoBFr0DVVRYl.webp" alt="">
                <p class="w-full">Nombre de la lista</p>
            </div>
            <div class="w-full text-center flex justify-center flex-wrap">
                <img class="w-full max-w-28 rounded-full" src="https://hdnqb6gk9llq7dvl.public.blob.vercel-storage.com/portadas/happy_day-5fTsYgd3tQ1fi4U5mNkoBFr0DVVRYl.webp" alt="">
                <p class="w-full">Nombre del artista</p>
            </div>
            <div class="w-full text-center flex justify-center flex-wrap">
                <img class="w-full max-w-28" src="https://hdnqb6gk9llq7dvl.public.blob.vercel-storage.com/portadas/happy_day-5fTsYgd3tQ1fi4U5mNkoBFr0DVVRYl.webp" alt="">
                <p class="w-full">Nombre de la lista</p>
            </div>
            <div class="w-full text-center flex justify-center flex-wrap">
                <img class="w-full max-w-28" src="https://hdnqb6gk9llq7dvl.public.blob.vercel-storage.com/portadas/happy_day-5fTsYgd3tQ1fi4U5mNkoBFr0DVVRYl.webp" alt="">
                <p class="w-full">Nombre del album</p>
            </div>
        </div>
    </div>

    <div class="flex justify-between w-full mt-2 flex-wrap">
        <h3 class="w-full text-xl md:text-2xl mb-2 font-bold">Recomendaciones para ti</h3>
        <div class="w-full grid grid-cols-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 lg:grid-rows-1">
            <div class="w-full text-center flex justify-center flex-wrap">
                <img class="w-full max-w-28" src="https://hdnqb6gk9llq7dvl.public.blob.vercel-storage.com/portadas/happy_day-5fTsYgd3tQ1fi4U5mNkoBFr0DVVRYl.webp" alt="">
                <p class="w-full">Nombre del album</p>
            </div>
            <div class="w-full text-center flex justify-center flex-wrap">
                <img class="w-full max-w-28" src="https://hdnqb6gk9llq7dvl.public.blob.vercel-storage.com/portadas/happy_day-5fTsYgd3tQ1fi4U5mNkoBFr0DVVRYl.webp" alt="">
                <p class="w-full">Nombre de la lista</p>
            </div>
            <div class="w-full text-center flex justify-center flex-wrap">
                <img class="w-full max-w-28 rounded-full" src="https://hdnqb6gk9llq7dvl.public.blob.vercel-storage.com/portadas/happy_day-5fTsYgd3tQ1fi4U5mNkoBFr0DVVRYl.webp" alt="">
                <p class="w-full">Nombre del artista</p>
            </div>
            <div class="w-full text-center flex justify-center flex-wrap">
                <img class="w-full max-w-28" src="https://hdnqb6gk9llq7dvl.public.blob.vercel-storage.com/portadas/happy_day-5fTsYgd3tQ1fi4U5mNkoBFr0DVVRYl.webp" alt="">
                <p class="w-full">Nombre de la lista</p>
            </div>
            <div class="w-full text-center flex justify-center flex-wrap">
                <img class="w-full max-w-28" src="https://hdnqb6gk9llq7dvl.public.blob.vercel-storage.com/portadas/happy_day-5fTsYgd3tQ1fi4U5mNkoBFr0DVVRYl.webp" alt="">
                <p class="w-full">Nombre del album</p>
            </div>
        </div>
    </div>
</div>

<script is:inline>
    contenidoResponsive()

    window.addEventListener('resize', () => {
        console.log("resize");

        contenidoResponsive()
    })

    function contenidoResponsive () {
        let caracteres;

        const ancho = window.innerWidth
        console.log(ancho);
        switch(true)
        {
            case ancho > 1200:
                caracteres = 20
                break;
            case ancho > 770:
                caracteres = 16
                break;
            default:
                caracteres = 10
        }
        console.log(caracteres);
        const elementos = document.getElementById("cartas").querySelectorAll("p")

        Array.from(elementos).forEach(parrafo => {
            if(parrafo.innerText.length >= caracteres)
            {
                const contenido = parrafo.dataset.original
                parrafo.innerText = contenido.slice(0, caracteres-2) + "..."
            }
        })
    }
</script>